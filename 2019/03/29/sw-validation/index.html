<!doctype html>
<html lang="en">
    <head><meta name="generator" content="Hexo 3.8.0">
		
        <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="">
        <link rel="shortcut icon" href="">
        <link rel="canonical" href="http://github.com/">
        <link rel="alternate" type="application/rss+xml" title="Ye Liang" href="">
        <title>Swap算法的验证 | 实验记录</title>
        <meta name="description" content="{{meta_description}}">

        <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/styles/crisp.css">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

    </head>
    
		<body class="post-template">
	

        <header id="header">
            
            <h1><a href="/">Ye Liang</a></h1>
            <p></p>
            <div id="follow-icons">
              </div>
<h6>---Tags---</h6>

<h6><a href="/tags/科学写作/" <="" a="">科学写作</a></h6>

<h6><a href="/tags/Lecture-Notes/" <="" a="">Lecture Notes</a></h6>

<h6><a href="/tags/WW项目/" <="" a="">WW项目</a></h6>

<h6><a href="/tags/月度总结/" <="" a="">月度总结</a></h6>

<h6><a href="/tags/Review/" <="" a="">Review</a></h6>

<h6><a href="/tags/阅读列表/" <="" a="">阅读列表</a></h6>


        </header>

        <main id="content">
        

<article class="post">
  March 29, 2019
  
    <span class="taglist">  &middot; 
    
    
      <a href="/tags/WW项目/">WW项目</a> 
    
    </span>
  

  <h1 class="post-title">Swap算法的验证</h1>
  <section class="post-content article-entry">
    <h1 id="实验背景和目的"><a href="#实验背景和目的" class="headerlink" title="实验背景和目的"></a>实验背景和目的</h1><p>在<a href="/2019/03/26/avb-change-boundary/">之前的实验</a>中，AVBMC算法给出了一些难以理解的现象。我们需要验证这些现象是由程序错误导致的，还是由算法的不足导致的，还是由模型本身的物理性质导致的。</p>
<h1 id="实验设计"><a href="#实验设计" class="headerlink" title="实验设计"></a>实验设计</h1><h2 id="实验1-证明：在变M和恒M系综下，只要恒M设置为变M的M期望，则采样等价。"><a href="#实验1-证明：在变M和恒M系综下，只要恒M设置为变M的M期望，则采样等价。" class="headerlink" title="实验1 证明：在变M和恒M系综下，只要恒M设置为变M的M期望，则采样等价。"></a>实验1 证明：在变M和恒M系综下，只要恒M设置为变M的M期望，则采样等价。</h2><p>统计物理可以证明这个命题是正确的。这里通过模拟验证这个命题。</p>
<p>我们首先从三维Ising模型开始验证($\kappa=0$)。在P相，无穷大体系$m=\langle|M|\rangle/N=0$。若待证明命题成立，那么只要将交换算法的初始M设为0即可获得等价采样。考虑到有限尺寸效应，在$T_c\approx4.512$之上一小段温度区间内仍不为零。我们将先使用Single Flip (SF)算法和Simple Swap (SW)算法，然后看AVB的结果。</p>
<h2 id="实验2-在-kappa-0-07-T-sim2-2-处验证SF和SW。"><a href="#实验2-在-kappa-0-07-T-sim2-2-处验证SF和SW。" class="headerlink" title="实验2 在$\kappa=0.07,T\sim2.2$处验证SF和SW。"></a>实验2 在$\kappa=0.07,T\sim2.2$处验证SF和SW。</h2><p>在$T=2.2$处，SF由于临界降速，得不到准确的能量均值，所以我们取一个稍微高于$T_c$的温度。早期的模拟观察到在$T=2.3$下采样受到临界降速的影响比在$T=2.2$时小很多。虽然实验1的命题应该在所有温度下都成立，但是在临界温度上，准确的M难以得到，所以可能SW难以得到准确的结果。这里我们需要观察SF和SW的差别可以有多大。</p>
<h2 id="实验3-验证SF和SW以及其混合算法的自关联时间。"><a href="#实验3-验证SF和SW以及其混合算法的自关联时间。" class="headerlink" title="实验3 验证SF和SW以及其混合算法的自关联时间。"></a>实验3 验证SF和SW以及其混合算法的自关联时间。</h2><p>我们希望比较在临界温度附近SF与SW的效率。这样我们必须精确地得到SF采样下在$\kappa=0.07,T=2.2$处的M，从而进行对应的SW采样。</p>
<p><a href="/2019/03/26/avb-change-boundary/">之前实验</a>中做的SF与AVBMC的自关联函数的比较原理是是错误的，因为采样不一致。那么如果得到了比较精确的M值，再跑对应的SW，那么自关联函数是什么样子呢？在高温下SW不如SF高效，低温下SW与SF效率几乎相同（实际上SW可以再提高），而在临界点时，实验2反映SW的效率比SF高（自关联时间短）。这在结果上和之前SF对比AVBMC的用错误的方法得到的结果很接近。那么自然我们也要想，会不会在SW和SF混合的时候也会出现AVBMC和SF混合的结果呢？我们需要数值验证。如果确实是这样的，那么我们需要理解为什么Swap算法和SF混合后效率降低。</p>
<h1 id="程序版本"><a href="#程序版本" class="headerlink" title="程序版本"></a>程序版本</h1><p>WidomWheelerSingleFlip v1.0<br>WidomWheelerSimpleSwap<br>WidomWheelerAVBMCSF</p>
<h1 id="数据存档位置"><a href="#数据存档位置" class="headerlink" title="数据存档位置"></a>数据存档位置</h1><h1 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h1><h2 id="实验1-SF与SW"><a href="#实验1-SF与SW" class="headerlink" title="实验1 SF与SW"></a>实验1 SF与SW</h2><p>三维Ising模型在$T=5.0$时，若是无穷大尺寸，则应该完美地处于P相，$|M|=0$。有限尺寸$N=24^3$下，两种方法采样的结果见表1。SF采样的结果是有0.03%的$|M|$（统计误差内不为0）。这时SF给出的能量（指单位粒子能量，下同）为-0.7578(2)，而SW给出的能量为-0.7556(1)，SW的能量均值比SF高出0.0022（大约3‰）。在$T=6.0$时，SF的$|M|/N$为0.00016，SF能量为-0.57167(5)，SW能量为-0.57078(5)，SW能量高0.00089（大约1.5‰）。我们可以看到两者能量略有差异，而且随着温度的升高差异在降低。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>T</th>
<th>$\tau_M$(SF)</th>
<th>$\tau_E$(SF)</th>
<th>&#124;M&#124;(SF)</th>
<th>E(SF)</th>
<th>E(SW)</th>
</tr>
</thead>
<tbody>
<tr>
<td>5.0</td>
<td>16.5</td>
<td>1.7</td>
<td>407(4)</td>
<td>-0.7578(1)</td>
<td>-0.7556(1)</td>
</tr>
<tr>
<td>6.0</td>
<td>4.5</td>
<td>0.8</td>
<td>229(1)</td>
<td>-0.57167(5)</td>
<td>-0.57078(5)</td>
</tr>
</tbody>
</table>
</div>
<p>表1: 三维Ising模型高温下SF和SW(M=0)得到的单位粒子能量。其中M指的是由SF采样得到的总磁矩绝对值的期望。在计算能量的误差时，SW能量的关联时间$\tau_E$用SF的近似替代。</p>
<p>这里备注：误差的估计，使用直接计算（Newman 3.4.1）和使用Bootstrap（Newman 4.3.2）得到的误差大致处于同一个数量级。</p>
<p>对于WW模型，在$T=6.0$时，无论从MF还是从早期MC研究，都应该处于P相。SF给出的M/N=0.00000(3)，能量为-0.42426(3)，SW给出的能量为-0.42407(3)，SW能量比SF高0.00019（大约0.44‰）。在$T=10.0$，SF给出的M/N=0.00008(2)，SF能量为-0.27142(3)，SW能量为-0.27121(3)。SF比SW高0.00021（大约0.77‰）。</p>
<p>这里有一个问题：<strong>此处的能量的差异是无论如何不能忽略的。</strong>这个能量的差异只能通过在有限温度下$|M|$略大于零来解释（注意上面所有的M都是没有加绝对值的）。这样设置$|M|=0$的系综和正则系综的采样稍有偏差，导致能量的期望有偏差。这个猜想可以通过实验验证。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>T</th>
<th>&#124;M&#124;(SF)</th>
<th>E(SF)</th>
<th>M(SW)</th>
<th>E(SW)</th>
</tr>
</thead>
<tbody>
<tr>
<td>3.0</td>
<td>251(2)</td>
<td>-0.7811(1)</td>
<td>252</td>
<td>-0.7807(1)</td>
</tr>
<tr>
<td>6.0</td>
<td>135.2(2)</td>
<td>-0.42426(3)</td>
<td>136</td>
<td>-0.42421(3)</td>
</tr>
<tr>
<td>10.0</td>
<td>115.7(3)</td>
<td>-0.27142(2)</td>
<td>116</td>
<td>-0.27134(3)</td>
</tr>
</tbody>
</table>
</div>
<p>表2: WW模型在P相下SF和SW采样的结果。</p>
<p>在$T=6.0$时，由SF模拟可知$N=24^3$的体系中$M=135.2(2)$；设置SW的$M=136$（因为翻转一个spin使得M变化2，所以M只能为偶数）。SW能量为-0.42421(3)。在$T=10.0$时，SF得到$|M|=115.7(3)$；设置SW的$M=116$，得到能量为-0.27134(3)。我们还补充了$T=3.0$时的采样结果，得到了可以接受的能量期望值。这样基本上两个模拟的能量就在误差限内了（毕竟磁矩不完全相等）。</p>
<h2 id="实验2-对WW模型在-kappa-0-07-T-sim2-2-处验证"><a href="#实验2-对WW模型在-kappa-0-07-T-sim2-2-处验证" class="headerlink" title="实验2 对WW模型在$\kappa=0.07,T\sim2.2$处验证"></a>实验2 对WW模型在$\kappa=0.07,T\sim2.2$处验证</h2><p>在$T=2.2$，SF给出的$|M|=5.4(1)\times10^3$，$\tau_M=250$，能量是-1.194(2)，$\tau_E=500$。在这个相点关联太强影响太大，简单的Bootstrap都得不到很稳定的结果，所以这里的误差都是直接估计的(Newman 3.4.1)。SW在$M=5426$时能量是-1.18546(4)，在$M=5428$时能量为-1.18557(4)，在$M=5366$时的能量是-1.18416(4)。</p>
<p>AVBMC在$M=5426$时给出能量-1.18554(4)，和SW基本一致。</p>
<p>我们再选择$T=2.3$验证，因为这个温度下采样的效率比$T=2.2$高很多，结果也更可靠。SF给出的$|M|=8.5(2)\times10^2$，能量是-1.0512(1)。SW给出的能量为-1.0503(1) ，基本上相差在误差范围内。这些差别都可以归结为M设置不完全等于SF的采样期望。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>T</th>
<th>$\tau_M$</th>
<th>&#124;M&#124;(SF)</th>
<th>$\tau_E$</th>
<th>E(SF)</th>
<th>M(SW)</th>
<th>E(SW)</th>
</tr>
</thead>
<tbody>
<tr>
<td>2.1</td>
<td>27</td>
<td>10264(5)</td>
<td>~27</td>
<td>-1.4377(4)</td>
<td>10264</td>
<td>-1.4367(2)</td>
</tr>
<tr>
<td>2.2</td>
<td>500</td>
<td>$5.4(1)\times10^3$</td>
<td>250</td>
<td>-1.194(2)</td>
<td>5426</td>
<td>-1.186(1)</td>
</tr>
<tr>
<td>2.3</td>
<td>65</td>
<td>$8.5(2)\times10^2$</td>
<td>6</td>
<td>-1.0512(1)</td>
<td>850</td>
<td>-1.0503(1)</td>
</tr>
<tr>
<td>2.4</td>
<td>23</td>
<td>548(6)</td>
<td>3.4</td>
<td>-0.99044(9)</td>
<td>548</td>
<td>-0.99025(9)</td>
</tr>
</tbody>
</table>
</div>
<p>表3: WW模型在$\kappa=0.07,T=2.2$下SF与SW的采样结果。因为磁矩的采样误差比较大（靠近临界点的必然结果），所以很难找到恰当的磁矩使SW刚好与SF采样等价。$T=2.1,2.3$采样效率比较高，得到的能量结果差别与误差处于同一范围，大致可以接受。</p>
<p>以上所有的模拟都运行了$2\times10^5$，但是对于$T=2.2$我们需要更大的样本集来得到SF的M。运行SF $1\times10^7$次（集群CPU时间5.3小时），按照之前计算的$\tau_M$，得到$|M|=5371(16)$，精确度比原来提升了一个数量级；能量期望为-1.1919(2)。SW在M=5370下给出的能量为-1.1849(8)。多次尝试不同的M的SW结果见表4。实际上与SF结果的能量期望接近的是M=5700的SW。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>T</th>
<th>$\tau_M$</th>
<th>&#124;M&#124;</th>
<th>$\tau_E$</th>
<th>E</th>
<th>sampling methond</th>
</tr>
</thead>
<tbody>
<tr>
<td>2.2</td>
<td>500</td>
<td>5371(16)</td>
<td>250</td>
<td>-1.1919(2)</td>
<td>SF</td>
</tr>
<tr>
<td>2.2</td>
<td>-</td>
<td>5370</td>
<td>60</td>
<td>-1.1849(8)</td>
<td>SW</td>
</tr>
<tr>
<td>2.2</td>
<td>-</td>
<td>5426</td>
<td>-</td>
<td>-1.186(1)</td>
<td>SW</td>
</tr>
<tr>
<td>2.2</td>
<td>-</td>
<td>5500</td>
<td>-</td>
<td>-1.1866(9)</td>
<td>SW</td>
</tr>
<tr>
<td>2.2</td>
<td>-</td>
<td>5700</td>
<td>-</td>
<td>-1.1918(5)</td>
<td>SW</td>
</tr>
</tbody>
</table>
</div>
<p>表4: WW模型在$\kappa=0.07, T=2.2$下SW尝试不同的M值的采样结果。</p>
<p>但是，不管M值设定为多少，只要大致在SF的M期望的周围，其能量自关联函数就相差不大：<br><img src="/img/avbmc/compare_SF_SW.png" alt="compare SF and SW" width="800"></p>
<h2 id="实验3-SF与SW的混合"><a href="#实验3-SF与SW的混合" class="headerlink" title="实验3 SF与SW的混合"></a>实验3 SF与SW的混合</h2><p>不出意外地，混合算法的自关联函数依然呈现出先上升后下降的现象。和导师细谈之后，发觉确实在临界温度上使用SF+SW没有意义。SF本身的自关联时间非常长，意味着算法本身难以平衡系统，这样一切平衡态统计量就没有意义了。</p>
<h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>实验1的结论：若设SW算法的M为SF在同一条件下的M的期望，那么SW能够给出相同的采样分布。<br>实验2的结论：在临界点($\kappa=0.07,T=2.2$)时，SW确实比SF有更短的自关联时间。<br>实验3的结论：在临界点比较SF和SW没有意义，我应该在稍远离临界点的温度下，确保算法能够使系统达到平衡以后，再计算平衡态可观测量。</p>
<h1 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h1><p>显然，我应该临界点之外选择一些温度点，测试SF和AVBMC。我可以用三条判据来说明算法达到平衡。在确保平衡的情况下，我可以计算对应的量包括自关联时间进行比较。</p>
<p>我特殊关注cluster算法造成大团簇的温度区间。我们之前认为造成大团簇意味着长关联长度。这会使得像SF这样的算法在这个区域严重失效，如同在临界点上一样。但是我读过一些文章，认为这个地方的Wolff类算法不能够正确反映关联长度。也就是说SF这样的算法在这个区间运行良好是正常的。我之前没有对此进行记录。显然我需要将这样的陈述记录整理一下，并且最好弄清楚为什么。</p>

  </section>
  <footer class="post-footer">
    <!--
    <section class="author">
      <h4>Ye Liang</h4>
      <p></p>
    </section>
    -->
  </footer>
</article>

<nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/2019/04/04/large-cluster-forming-region/">
        ← prev <!--在cluster算法生成大团簇的温度区间内比较SF、AVBMC和cluster算法-->
    </a>
    
    <span class="page-number">•</span>
    
    <a class="older-posts" href="/2019/03/26/avb-change-boundary/">
        <!--修正AVBMC算法中的边界定义--> next →
    </a>
    
</nav>


        </main>
        <footer id="footer">
            <section id="footer-message">&copy; 2019 Ye Liang. All rights reserved. Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. </section>
        </footer>
        
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!--<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>
</html>


